<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus | Main</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
       <link rel="icon" type="image/png" sizes="32x32" href="focus-logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="focus-logo.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #000000 100%);
            min-height: 100vh;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .navbar {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid #333;
            padding: 0.5rem 0;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: #ffffff !important;
        }

        .navbar-text {
            color: #cccccc !important;
            font-size: 0.9rem;
        }

        .main-container {
            padding: 1rem 0;
        }

        .timer-card, .todo-list {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #333;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            margin-bottom: 1.5rem;
            height: fit-content;
        }

        /* Digital Clock Styles */
        .digital-clock-container {
            background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
            border: 3px solid #333;
            border-radius: 25px;
            padding: 2rem 1rem;
            margin: 1.5rem 0;
            box-shadow: 
                inset 0 4px 8px rgba(0, 0, 0, 0.3),
                0 8px 32px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .digital-clock-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .digital-display {
            background: #000;
            border: 2px solid #444;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.8);
        }

        .timer-digits {
            font-family: 'Orbitron', monospace;
            font-size: 3.5rem;
            font-weight: 700;
            color: #00ff41;
            letter-spacing: 0.1em;
            margin: 0;
            line-height: 1;
        }

        .timer-colon {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .timer-label {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .progress-bar-container {
            background: #222;
            border-radius: 25px;
            height: 8px;
            margin: 1rem 0;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff41, #00cc33);
            border-radius: 25px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }

        .timer-controls {
            text-align: center;
            margin: 1.5rem 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #333, #555);
            border: 2px solid #ffffff;
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            max-width: 200px;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #555, #777);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.2);
            color: #ffffff;
            border-color: #ffffff;
        }

        .btn-secondary {
            background: #444;
            border: 2px solid #666;
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            max-width: 200px;
        }

        .btn-secondary:hover {
            background: #666;
            color: #ffffff;
            border-color: #888;
        }

        .btn-success {
            background: #333;
            border: 2px solid #ffffff;
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
        }

        .btn-success:hover {
            background: #555;
            color: #ffffff;
            border-color: #ffffff;
        }

        .input-group {
            margin: 1rem 0;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        .input-label {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-control {
            border-radius: 15px;
            border: 2px solid #666;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.7);
            color: #ffffff;
            font-size: 0.9rem;
        }

        .form-control:focus {
            border-color: #ffffff;
            box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25);
            background: rgba(0, 0, 0, 0.8);
            color: #ffffff;
        }

        .form-control::placeholder {
            color: #aaa;
        }

        .todo-list {
            max-height: 70vh;
            overflow-y: auto;
        }

        .todo-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid #ffffff;
            transition: all 0.3s ease;
            border: 1px solid #333;
        }

        .todo-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.15);
        }

        .todo-date {
            font-size: 0.75rem;
            color: #aaa;
            margin-bottom: 0.5rem;
        }

        .todo-title {
            font-weight: 600;
            color: #ffffff;
            font-size: 0.95rem;
        }

        .todo-description {
            font-size: 0.85rem;
            color: #ccc;
            margin-top: 0.5rem;
        }

        .todo-duration {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .modal-content {
            border-radius: 20px;
            border: 2px solid #333;
            background: rgba(0, 0, 0, 0.9);
            color: #ffffff;
        }

        .modal-header {
            background: linear-gradient(45deg, #333, #555);
            color: white;
            border-radius: 20px 20px 0 0;
            border-bottom: 1px solid #666;
        }

        .modal-body {
            background: rgba(0, 0, 0, 0.9);
        }

        .modal-footer {
            background: rgba(0, 0, 0, 0.9);
            border-top: 1px solid #666;
        }

        .break-popup {
            background: rgba(0, 0, 0, 0.95);
            color: white;
        }

        .break-popup .modal-header {
            background: linear-gradient(45deg, #333, #666);
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #666;
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            justify-content: center;
        }

        .social-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            color: white;
            border-color: #ffffff;
        }

        .badge {
            background: #333 !important;
            border: 1px solid #666;
            color: #ffffff !important;
            font-size: 0.8rem;
        }

        .badge.bg-primary {
            background: #333 !important;
            border-color: #ffffff;
        }

        .badge.bg-success {
            background: #444 !important;
            border-color: #ffffff;
        }

        .badge.bg-warning {
            background: #555 !important;
            border-color: #ffffff;
        }

        .text-muted {
            color: #aaa !important;
        }

        .text-success {
            color: #ccc !important;
        }

        .fullscreen-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1050;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #666;
            color: #ffffff;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fullscreen-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #ffffff;
            transform: scale(1.1);
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .navbar-brand {
                font-size: 1.3rem;
            }
            
            .navbar-text {
                font-size: 0.8rem;
            }
            
            .main-container {
                padding: 0.5rem 0;
                margin-top: 70px !important;
            }
            
            .timer-card, .todo-list {
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: 15px;
            }
            
            .digital-clock-container {
                padding: 1rem 0.5rem;
                margin: 1rem 0;
            }
            
            .digital-display {
                padding: 1rem;
            }
            
            .timer-digits {
                font-size: 2.5rem;
            }
            
            .timer-controls {
                margin: 1rem 0;
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn-primary, .btn-secondary {
                margin: 0.25rem 0;
                padding: 12px 15px;
                min-width: auto;
                max-width: none;
            }
            
            .input-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .form-control {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .todo-list {
                max-height: 50vh;
            }
            
            .todo-item {
                padding: 0.75rem;
            }
            
            .social-links {
                flex-direction: column;
                gap: 10px;
            }
            
            .social-link {
                min-width: auto;
            }
            
            .fullscreen-toggle {
                width: 40px;
                height: 40px;
                top: 10px;
                right: 10px;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h4 {
                font-size: 1.2rem;
            }
            
            .modal-dialog {
                margin: 1rem;
            }
            
            .todo-date {
                font-size: 0.7rem;
            }
            
            .todo-title {
                font-size: 0.9rem;
            }
            
            .todo-description {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .timer-digits {
                font-size: 2rem;
            }
            
            .digital-display {
                padding: 0.75rem;
            }
            
            .timer-card, .todo-list {
                padding: 0.75rem;
            }
            
            .btn-primary, .btn-secondary {
                padding: 10px 12px;
                font-size: 0.85rem;
            }
            
            .form-control {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
            
            .social-link {
                padding: 10px 15px;
                font-size: 0.85rem;
            }
            
            .todo-item {
                padding: 0.5rem;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #333;
        }

        ::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #888;
        }
    </style>
</head>
<body>
    <!-- Fullscreen Toggle Button -->
    <div class="fullscreen-toggle" id="fullscreenToggle" title="Toggle Fullscreen (Press ESC to exit)">
        <i class="fas fa-expand"></i>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-brain"></i> Focus
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-calendar"></i> <span id="currentDate"></span>&nbsp;&nbsp;
                </span>
            </div>
            <a href = "aboutus.html" style = "color:white;" class = "btn">Developers</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container main-container" style="margin-top: 80px;">
        <div class="row">
            <!-- Timer Section -->
            <div class="col-lg-6">
                <div class="timer-card fade-in">
                    <h2 class="text-center mb-3">
                        <i class="fas fa-clock"></i> Study Timer
                    </h2>
                    
                    <div class="input-row">
                        <div class="input-field">
                            <label class="input-label">Study Time</label>
                            <input type="number" class="form-control" id="studyMinutes" placeholder="25" min="1" max="120" value="25">
                        </div>
                        <div class="input-field">
                            <label class="input-label">Break Time</label>
                            <input type="number" class="form-control" id="breakMinutes" placeholder="5" min="1" max="30" value="5">
                        </div>
                    </div>

                    <!-- Task Input -->
                    <div class="input-group mb-2">
                        <input type="text" class="form-control" id="taskTitle" placeholder="What are you working on?">
                    </div>
                    
                    <div class="input-group mb-3">
                        <textarea class="form-control" id="taskDescription" placeholder="Task description (optional)" rows="2"></textarea>
                    </div>

                    <!-- Digital Clock Display -->
                    <div class="digital-clock-container">
                        <div class="digital-display">
                            <div class="timer-digits" id="timerDisplay">25<span class="timer-colon">:</span>00</div>
                            <div class="timer-label">FOCUS TIME</div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Timer Status -->
                    <div class="text-center mb-3">
                        <span class="badge bg-primary fs-6" id="timerStatus">Ready to Focus</span>
                    </div>

                    <!-- Timer Controls -->
                    <div class="timer-controls">
                        <button class="btn btn-primary" id="startBtn">
                            <i class="fas fa-play"></i> Start Focus
                        </button>
                        <button class="btn btn-secondary" id="pauseBtn" disabled>
                            <i class="fas fa-pause"></i> Pause
                        </button>
                        <button class="btn btn-secondary" id="resetBtn">
                            <i class="fas fa-stop"></i> Reset
                        </button>
                    </div>
                </div>
            </div>

            <!-- Todo List Section -->
            <div class="col-lg-6">
                <div class="todo-list fade-in">
                    <h2 class="text-center mb-3">
                        <i class="fas fa-list-check"></i> Task Manager
                    </h2>
                    
                    <!-- Add Task Form -->
                    <div class="mb-3">
                        <div class="input-group mb-2">
                            <input type="text" class="form-control form-control-sm" id="newTaskTitle" placeholder="Add new task...">
                        </div>
                        <div class="input-group mb-2">
                            <textarea class="form-control form-control-sm" id="newTaskDesc" placeholder="Task description..." rows="2"></textarea>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-primary btn-sm" id="addTaskBtn">
                                <i class="fas fa-plus"></i> Add Task
                            </button>
                        </div>
                    </div>
                    
                    <hr style="border-color: #666;">
                    
                    <!-- Tasks Container -->
                    <div id="todoContainer">
                        <div class="text-center text-muted">
                            <i class="fas fa-clipboard-list fa-3x mb-3"></i>
                            <p>Your tasks and completed focus sessions will appear here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Complete Modal -->
    <div class="modal fade" id="sessionCompleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-trophy"></i> Session Complete!
                    </h5>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-check-circle fa-4x text-success"></i>
                    </div>
                    <h4>Great job! You completed your focus session.</h4>
                    <p class="text-muted">Time to save your progress and take a well-deserved break.</p>
                    
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="modalTaskTitle" placeholder="Task title">
                    </div>
                    
                    <div class="input-group mb-3">
                        <textarea class="form-control" id="modalTaskDescription" placeholder="What did you accomplish?" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="saveTaskBtn">
                        <i class="fas fa-save"></i> Save & Take Break
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Break Time Modal -->
    <div class="modal fade" id="breakModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content break-popup">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-coffee"></i> Break Time!
                    </h5>
                    <div class="ms-auto">
                        <span class="badge bg-light text-dark" id="breakTimer">5:00</span>
                    </div>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-smile fa-4x"></i>
                    </div>
                    <h4>Time for a break!</h4>
                    <p>Relax and recharge. You can explore these if you want:</p>
                    
                    <div class="social-links">
                        <a href="https://youtube.com" target="_blank" class="social-link" id="youtubeLink">
                            <i class="fab fa-youtube fa-2x"></i>
                            <span>YouTube</span>
                        </a>
                        <a href="https://instagram.com" target="_blank" class="social-link" id="instagramLink">
                            <i class="fab fa-instagram fa-2x"></i>
                            <span>Instagram</span>
                        </a>
                    </div>
                    
                    <p class="mt-3">
                        <small><i class="fas fa-info-circle"></i> This break will automatically end in <span id="breakTimeLeft">5:00</span></small>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
 $(document).ready(function() {
    // Timer variables
    let studyTimer = null;
    let breakTimer = null;
    let studyTimeLeft = 25 * 60; // 25 minutes in seconds
    let breakTimeLeft = 5 * 60; // 5 minutes in seconds
    let isStudySession = true;
    let isPaused = false;
    let totalStudyTime = 25 * 60;
    let totalBreakTime = 5 * 60;

    // Initialize
    updateCurrentDate();
    loadTasks();
    
    // Auto-enter fullscreen on page load
    setTimeout(function() {
        if (isFullscreenSupported() && !isCurrentlyFullscreen()) {
            enterFullscreen();
        }
    }, 500);

    // Fullscreen functionality
    function isFullscreenSupported() {
        return !!(document.fullscreenEnabled || 
                 document.webkitFullscreenEnabled || 
                 document.mozFullScreenEnabled ||
                 document.msFullscreenEnabled);
    }

    function isCurrentlyFullscreen() {
        return !!(document.fullscreenElement || 
                 document.webkitFullscreenElement || 
                 document.mozFullScreenElement ||
                 document.msFullscreenElement);
    }

    function enterFullscreen() {
        const elem = document.documentElement;
        
        if (elem.requestFullscreen) {
            elem.requestFullscreen().catch(err => {
                console.log('Error attempting to enable fullscreen:', err);
            });
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        } else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
    }

    function exitFullscreen() {
        if (document.exitFullscreen) {
            document.exitFullscreen().catch(err => {
                console.log('Error attempting to exit fullscreen:', err);
            });
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    }

    function toggleFullscreen() {
        if (!isFullscreenSupported()) {
            alert('Fullscreen is not supported in this browser');
            return;
        }
        
        if (isCurrentlyFullscreen()) {
            exitFullscreen();
        } else {
            enterFullscreen();
        }
    }

    function updateFullscreenButton() {
        const isFullscreen = isCurrentlyFullscreen();
        const icon = $('#fullscreenToggle i');
        const button = $('#fullscreenToggle');
        
        if (isFullscreen) {
            icon.removeClass('fa-expand').addClass('fa-compress');
            button.attr('title', 'Exit Fullscreen (Press ESC)');
        } else {
            icon.removeClass('fa-compress').addClass('fa-expand');
            button.attr('title', 'Enter Fullscreen');
        }
    }

    // Event listeners for fullscreen
    $('#fullscreenToggle').click(function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleFullscreen();
    });

    // Listen for all fullscreen change events
    document.addEventListener('fullscreenchange', updateFullscreenButton);
    document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
    document.addEventListener('mozfullscreenchange', updateFullscreenButton);
    document.addEventListener('MSFullscreenChange', updateFullscreenButton);

    // Handle ESC key
    $(document).keydown(function(e) {
        if (e.key === 'Escape' || e.keyCode === 27) {
            setTimeout(updateFullscreenButton, 100);
        }
    });

    // Initialize fullscreen button state
    updateFullscreenButton();

    // Update current date
    function updateCurrentDate() {
        const now = new Date();
        const options = { 
            weekday: 'short', 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
        };
        $('#currentDate').text(now.toLocaleDateString('en-US', options));
    }

    // Format time display
    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    // Update timer display
    function updateTimerDisplay() {
        if (isStudySession) {
            const timeString = formatTime(studyTimeLeft);
            $('#timerDisplay').html(timeString.replace(':', '<span class="timer-colon">:</span>'));
            
            // Update progress bar
            const progress = ((totalStudyTime - studyTimeLeft) / totalStudyTime) * 100;
            $('#progressBar').css('width', progress + '%');
            
            // Update timer label
            $('.timer-label').text('FOCUS TIME');
        } else {
            $('#breakTimer, #breakTimeLeft').text(formatTime(breakTimeLeft));
        }
    }

    // Start study timer
    function startStudyTimer() {
        studyTimer = setInterval(() => {
            if (!isPaused) {
                studyTimeLeft--;
                updateTimerDisplay();
                
                if (studyTimeLeft <= 0) {
                    clearInterval(studyTimer);
                    studyTimeLeft = 0;
                    updateTimerDisplay();
                    endStudySession();
                }
            }
        }, 1000);
    }

    // Start break timer
    function startBreakTimer() {
        breakTimer = setInterval(() => {
            if (!isPaused) {
                breakTimeLeft--;
                updateTimerDisplay();
                
                if (breakTimeLeft <= 0) {
                    clearInterval(breakTimer);
                    breakTimeLeft = 0;
                    updateTimerDisplay();
                    endBreak();
                }
            }
        }, 1000);
    }

    // End study session
    function endStudySession() {
        isStudySession = false;
        $('#timerStatus').removeClass('bg-primary').addClass('bg-success').text('Session Complete');
        $('#timerDisplay').html(formatTime(breakTimeLeft).replace(':', '<span class="timer-colon">:</span>'));
        $('.timer-label').text('BREAK TIME');
        
        // Show session complete modal
        const taskTitle = $('#taskTitle').val();
        const taskDesc = $('#taskDescription').val();
        $('#modalTaskTitle').val(taskTitle);
        $('#modalTaskDescription').val(taskDesc);
        
        $('#sessionCompleteModal').modal('show');
    }

    // Save task and start break
    $('#saveTaskBtn').click(function() {
        const title = $('#modalTaskTitle').val();
        const description = $('#modalTaskDescription').val();
        
        if (title.trim() !== '') {
            addTask(title, description, totalStudyTime);
            $('#taskTitle').val('');
            $('#taskDescription').val('');
        }
        
        $('#sessionCompleteModal').modal('hide');
        startBreak();
    });

    // Start break
    function startBreak() {
        isStudySession = false;
        $('#timerStatus').removeClass('bg-primary').addClass('bg-warning').text('Break Time');
        $('.timer-label').text('BREAK TIME');
        $('#progressBar').css('width', '0%');
        
        // Show break modal
        $('#breakModal').modal('show');
        startBreakTimer();
    }

    // End break
    function endBreak() {
        clearInterval(breakTimer);
        $('#breakModal').modal('hide');
        resetTimer();
        $('#timerStatus').removeClass('bg-warning').addClass('bg-primary').text('Ready to Focus');
    }

    // Reset timer
    function resetTimer() {
        clearInterval(studyTimer);
        clearInterval(breakTimer);
        
        studyTimeLeft = parseInt($('#studyMinutes').val()) * 60 || 25 * 60;
        breakTimeLeft = parseInt($('#breakMinutes').val()) * 60 || 5 * 60;
        totalStudyTime = studyTimeLeft;
        totalBreakTime = breakTimeLeft;
        
        isStudySession = true;
        isPaused = false;
        
        $('#timerDisplay').html(formatTime(studyTimeLeft).replace(':', '<span class="timer-colon">:</span>'));
        $('.timer-label').text('FOCUS TIME');
        $('#progressBar').css('width', '0%');
        
        $('#startBtn').prop('disabled', false);
        $('#pauseBtn').prop('disabled', true);
        $('#resetBtn').prop('disabled', false);
        
        $('#timerStatus').removeClass('bg-warning bg-success').addClass('bg-primary').text('Ready to Focus');
    }

    // Task management
    function addTask(title, description, duration) {
        const taskId = Date.now();
        const now = new Date();
        const dateString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        const durationString = Math.floor(duration / 60) + ' min';
        
        const taskElement = `
            <div class="todo-item" data-id="${taskId}">
                <div class="todo-date">${dateString}</div>
                <div class="todo-title">${title}</div>
                <div class="todo-description">${description}</div>
                <div class="todo-duration">${durationString}</div>
                <div class="text-end mt-2">
                    <button class="btn btn-sm btn-outline-danger delete-task" data-id="${taskId}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
        
        // If no tasks exist, remove the placeholder
        if ($('#todoContainer').children().length === 1 && $('#todoContainer').children().first().hasClass('text-center')) {
            $('#todoContainer').empty();
        }
        
        $('#todoContainer').prepend(taskElement);
        saveTask(taskId, title, description, dateString, durationString);
    }

    function saveTask(id, title, description, date, duration) {
        try {
            let tasks = JSON.parse(localStorage.getItem('focusTasks')) || [];
            tasks.unshift({ id, title, description, date, duration });
            localStorage.setItem('focusTasks', JSON.stringify(tasks));
        } catch (e) {
            console.log('LocalStorage not available, tasks will not be saved');
        }
    }

    function loadTasks() {
        try {
            const tasks = JSON.parse(localStorage.getItem('focusTasks')) || [];
            
            if (tasks.length > 0) {
                $('#todoContainer').empty();
                
                tasks.forEach(task => {
                    const taskElement = `
                        <div class="todo-item" data-id="${task.id}">
                            <div class="todo-date">${task.date}</div>
                            <div class="todo-title">${task.title}</div>
                            <div class="todo-description">${task.description}</div>
                            <div class="todo-duration">${task.duration}</div>
                            <div class="text-end mt-2">
                                <button class="btn btn-sm btn-outline-danger delete-task" data-id="${task.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    $('#todoContainer').append(taskElement);
                });
            }
        } catch (e) {
            console.log('LocalStorage not available, cannot load tasks');
        }
    }

    function deleteTask(id) {
        try {
            let tasks = JSON.parse(localStorage.getItem('focusTasks')) || [];
            tasks = tasks.filter(task => task.id != id);
            localStorage.setItem('focusTasks', JSON.stringify(tasks));
        } catch (e) {
            console.log('LocalStorage not available, cannot save task deletion');
        }
        
        $(`[data-id="${id}"]`).remove();
        
        // If no tasks left, show placeholder
        if ($('#todoContainer').children().length === 0) {
            $('#todoContainer').html(`
                <div class="text-center text-muted">
                    <i class="fas fa-clipboard-list fa-3x mb-3"></i>
                    <p>Your tasks and completed focus sessions will appear here</p>
                </div>
            `);
        }
    }

    // Event listeners
    $('#startBtn').click(function() {
        studyTimeLeft = parseInt($('#studyMinutes').val()) * 60 || 25 * 60;
        breakTimeLeft = parseInt($('#breakMinutes').val()) * 60 || 5 * 60;
        totalStudyTime = studyTimeLeft;
        totalBreakTime = breakTimeLeft;
        
        isStudySession = true;
        isPaused = false;
        
        $('#timerStatus').removeClass('bg-warning bg-success').addClass('bg-primary').text('Focusing...');
        $('#startBtn').prop('disabled', true);
        $('#pauseBtn').prop('disabled', false);
        $('#resetBtn').prop('disabled', false);
        
        startStudyTimer();
    });

    $('#pauseBtn').click(function() {
        isPaused = !isPaused;
        
        if (isPaused) {
            $('#pauseBtn').html('<i class="fas fa-play"></i> Resume');
            $('#timerStatus').text('Paused');
        } else {
            $('#pauseBtn').html('<i class="fas fa-pause"></i> Pause');
            $('#timerStatus').text(isStudySession ? 'Focusing...' : 'Break Time');
        }
    });

    $('#resetBtn').click(function() {
        resetTimer();
    });

    $('#addTaskBtn').click(function() {
        const title = $('#newTaskTitle').val().trim();
        const description = $('#newTaskDesc').val().trim();
        
        if (title !== '') {
            addTask(title, description, 0);
            $('#newTaskTitle').val('');
            $('#newTaskDesc').val('');
        }
    });

    $(document).on('click', '.delete-task', function() {
        const taskId = $(this).data('id');
        deleteTask(taskId);
    });

    // Keyboard shortcuts
    $(document).keydown(function(e) {
        // Space to pause/resume (only if not typing in input fields)
        if (e.key === ' ' && !$('input, textarea').is(':focus')) {
            e.preventDefault();
            if (!$('#pauseBtn').prop('disabled')) {
                $('#pauseBtn').click();
            }
        }
        
        // Enter to start timer when in study minutes field
        if (e.key === 'Enter' && $('#studyMinutes').is(':focus')) {
            e.preventDefault();
            if (!$('#startBtn').prop('disabled')) {
                $('#startBtn').click();
            }
        }
        
        // Enter to add task when in new task field
        if (e.key === 'Enter' && ($('#newTaskTitle').is(':focus') || $('#newTaskDesc').is(':focus'))) {
            e.preventDefault();
            $('#addTaskBtn').click();
        }
    });

    // Initialize timer display
    updateTimerDisplay();
});
    </script>
</body>
</html>